<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="x-icon" href="admaa.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchant Form Search - ADMAA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --gray: #7f8c8d;
            --success: #2ecc71;
            --border: #ddd;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
            --bg-color: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --form-bg: white;
            --text-color: #333;
            --section-bg: #f9fafb;
            --section-border: #f9fafb;
            --input-bg: white;
            --input-border: var(--border);
        }

        body.dark-theme {
            --bg-color: #2c3e50;
            --form-bg: #34495e;
            --text-color: #ecf0f1;
            --section-bg: #293a4a;
            --section-border: #4a637d;
            --input-bg: #4c6883;
            --input-border: #5a748c;
            --border: #5a748c;
            --gray: #bdc3c7;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background-color: var(--form-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            font-weight: bold;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        h1 {
            color: var(--secondary);
            margin-bottom: 10px;
            font-weight: 700;
            font-size: 2.2rem;
            transition: color 0.3s;
        }
        
        body.dark-theme h1 {
             color: var(--light);
        }

        .subtitle {
            color: var(--gray);
            font-size: 1rem;
            margin-top: 0;
            transition: color 0.3s;
        }

        .search-panel {
            background-color: var(--section-bg);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary);
            transition: color 0.3s;
        }
        
        body.dark-theme label {
             color: var(--gray);
        }

        input[type="text"], input[type="date"], select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        body.dark-theme input, body.dark-theme select {
            color: var(--light);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: var(--gray);
            color: white;
        }

        .btn-secondary:hover {
            background: #6c757d;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .results-container {
            margin-top: 40px;
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .results-count {
            font-size: 1.1rem;
            color: var(--gray);
        }

        .form-card {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--success);
            transition: transform 0.3s;
        }

        .form-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .form-id {
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .form-date {
            color: var(--gray);
            font-size: 14px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .detail-group {
            margin-bottom: 12px;
        }

        .detail-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 14px;
            color: var(--text-color);
            font-weight: 500;
            padding: 8px 12px;
            background: var(--input-bg);
            border-radius: 6px;
            border: 1px solid var(--input-border);
            min-height: 40px;
            display: flex;
            align-items: center;
        }

        .qr-info {
            background: #e8f4fd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid var(--primary);
        }
        
        body.dark-theme .qr-info {
            background: #293a4a;
        }

        .qr-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .pagination-btn {
            padding: 10px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .page-info {
            font-size: 14px;
            color: var(--gray);
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: var(--gray);
        }

        .no-results i {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--gray);
        }

        #theme-toggle {
            background-color: var(--secondary);
            color: var(--light);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }

        #theme-toggle:hover {
            background-color: var(--primary-dark);
        }

        .export-btn {
            background: var(--success);
            color: white;
        }

        .export-btn:hover {
            background: #27ae60;
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--secondary);
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        body.dark-theme .section-title {
             color: var(--light);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .pagination {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            #theme-toggle {
                width: 100%;
            }
        }
    </style>
</head>
<body class="light-theme">
    <div class="container">
        <div class="form-header">
            <div class="logo">ADMAA - Form Search</div>
            <button id="theme-toggle">
                <i class="fas fa-moon"></i> Toggle Theme
            </button>
        </div>
        
        <div class="header">
            <h1><i class="fas fa-search"></i> Merchant Form Search</h1>
            <p class="subtitle">Search and view submitted merchant forms from the database</p>
        </div>
        
        <div class="search-panel">
            <div class="section-title">
                <i class="fas fa-filter"></i> Search Filters
            </div>
            
            <div class="search-grid">
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> MONTH</label>
                    <select id="searchMonth">
                        <option value="">All Months</option>
                        <option value="JAN">JAN</option>
                        <option value="FEB">FEB</option>
                        <option value="APR">APR</option>
                        <option value="MAY">MAY</option>
                        <option value="JUN">JUN</option>
                        <option value="JUL">JUL</option>
                        <option value="AUG">AUG</option>
                        <option value="SEP">SEP</option>
                        <option value="OCT">OCT</option>
                        <option value="NOV">NOV</option>
                        <option value="DEC">DEC</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> CATEGORY</label>
                    <select id="searchCategory">
                        <option value="">All Categories</option>
                        <option value="MOBILE SHOP & COMMUNICATION">MOBILE SHOP & COMMUNICATION</option>
                        <option value="EATERIES/RESTAURANT">EATERIES/RESTAURANT</option>
                        <option value="TAILOR">TAILOR</option>
                        <option value="ELECTRIC SHOP">ELECTRIC SHOP</option>
                        <option value="CLOTHING / GARMENTS">CLOTHING / GARMENTS</option>
                        <!-- More options can be added here later -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-map-marker-alt"></i> LOCATION</label>
                    <select id="searchLocation">
                        <option value="">All Locations</option>
                        <option value="BAHRIA TOWN">BAHRIA TOWN</option>
                        <option value="BALDIA TOWN">BALDIA TOWN</option>
                        <option value="BALDIA TOWNSITE AREA">BALDIA TOWNSITE AREA</option>
                        <option value="CLIFTON">CLIFTON</option>
                        <option value="CLIFTON BLOCK 2">CLIFTON BLOCK 2</option>
                        <option value="CLIFTON-SADDAR">CLIFTON-SADDAR</option>
                        <option value="DHA">DHA</option>
                        <option value="F.B AREA">F.B AREA</option>
                        <option value="G-11 MARKAZ">G-11 MARKAZ</option>
                        <option value="GOLIMAR">GOLIMAR</option>
                        <option value="GUL PLAZA">GUL PLAZA</option>
                        <option value="GULISTAN-E-JOUHAR">GULISTAN-E-JOUHAR</option>
                        <option value="GULISTAN-E-IQBAL">GULISTAN-E-IQBAL</option>
                        <option value="II CHUNDIGARH">II CHUNDIGARH</option>
                        <option value="KEAMARI">KEAMARI</option>
                        <option value="KORANGI">KORANGI</option>
                        <option value="LANDHI">LANDHI</option>
                        <option value="LE MARKET">LE MARKET</option>
                        <option value="LIAQUATABAD">LIAQUATABAD</option>
                        <option value="LYARI">LYARI</option>
                        <option value="MACHAR COLONY">MACHAR COLONY</option>
                        <option value="MALIR">MALIR</option>
                        <option value="MANZOOR COLONY">MANZOOR COLONY</option>
                        <option value="MARIPURE">MARIPURE</option>
                        <option value="MAYMAR">MAYMAR</option>
                        <option value="MEHMOODABAD">MEHMOODABAD</option>
                        <option value="N.KARACHI">N.KARACHI</option>
                        <option value="N.NAZIMABAD">N.NAZIMABAD</option>
                        <option value="NAZIMABAD">NAZIMABAD</option>
                        <option value="ORANGI TOWN">ORANGI TOWN</option>
                        <option value="PECHS">PECHS</option>
                        <option value="SADDAR">SADDAR</option>
                        <option value="SAFOORA">SAFOORA</option>
                        <option value="SCHEME 33">SCHEME 33</option>
                        <option value="SHAH FAISAL">SHAH FAISAL</option>
                        <option value="SHAHRAH-E-FAISAL">SHAHRAH-E-FAISAL</option>
                        <option value="SHERSHAH">SHERSHAH</option>
                        <option value="SITE AREA">SITE AREA</option>
                        <option value="SKARDU">SKARDU</option>
                        <option value="SULTANABAD">SULTANABAD</option>
                        <option value="SUKKAR">SUKKAR</option>
                        <!-- More options can be added here later -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-university"></i> BANK</label>
                    <select id="searchBank">
                        <option value="">All Banks</option>
                        <option value="ABL">ABL</option>
                        <option value="AL-BARAKA">AL-BARAKA</option>
                        <option value="ASKARI">ASKARI</option>
                        <option value="BAFL">BAFL</option>
                        <option value="BAHL">BAHL</option>
                        <option value="BKIP">BKIP</option>
                        <option value="BML">BML</option>
                        <option value="BOP">BOP</option>
                        <option value="DIBL">DIBL</option>
                        <option value="EASYPAISA">EASYPAISA</option>
                        <option value="FBL"></option>
                        <option value="HBL">HBL</option>
                        <option value="HMB">HMB</option>
                        <option value="JAZZ CASH">JAZZ CASH</option>
                        <option value="JS">JS</option>
                        <option value="MCB">MCB</option>
                        <option value="MEEZAN">MEEZAN</option>
                        <option value="NAYAPAY">NAYAPAY</option>
                        <option value="NBP">NBP</option>
                        <option value="SCB">SCB</option>
                        <option value="SCBL">SCBL</option>
                        <option value="SILK">SILK</option>
                        <option value="SONBL">SONBL</option>
                        <option value="SONE">SONE</option>
                        <option value="UBL">UBL</option>
                        <option value="UPAISA">UPAISA</option>
                        <option value="ZINDAGI">ZINDAGI</option>
                        <!-- More options can be added here later -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-check-circle"></i> STATUS-2</label>
                    <select id="searchStatus">
                        <option value="">All Status</option>
                        <option value="DEPLOYED">DEPLOYED</option>
                        <option value="CLOSED">CLOSED</option>
                        <option value="SENT FOR PRINTING">SENT FOR PRINTING</option>
                        <option value="IBAN RECEIVED">IBAN RECEIVED</option>
                        <!-- More options can be added here later -->
                    </select>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="searchForms()">
                    <i class="fas fa-search"></i> Search Forms
                </button>
                <button class="btn btn-secondary" onclick="resetFilters()">
                    <i class="fas fa-redo"></i> Reset Filters
                </button>
                <button class="btn btn-success export-btn" onclick="exportResults()" style="display: none;" id="exportBtn">
                    <i class="fas fa-download"></i> Export Results
                </button>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Searching merchant forms...</p>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2><i class="fas fa-list"></i> Search Results</h2>
                <div class="results-count" id="resultsCount">Showing 0 results</div>
            </div>
            
            <div id="resultsList"></div>
            
            <div class="pagination" id="pagination">
                <button class="pagination-btn" onclick="previousPage()" id="prevBtn">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <span class="page-info" id="pageInfo">Page 1 of 1</span>
                <button class="pagination-btn" onclick="nextPage()" id="nextBtn">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <div class="footer" style="margin-top: 40px; text-align: center; padding-top: 20px; border-top: 1px solid var(--border); color: var(--gray);">
            <p>ADMAA Retail Enablement Service (Pvt.) Ltd.<br>
            <i class="fas fa-globe"></i> <a href="https://admaa.pk" target="_blank" style="color: var(--primary);">admaa.pk</a> | 
            <i class="fas fa-phone"></i> 0300-8332737</p>
        </div>
    </div>

    <script>
        // Configuration - Update with your n8n webhook URL
        const N8N_SEARCH_WEBHOOK = 'https://noral.gleeze.com/webhook/form-search';
        
        let currentPage = 1;
        const itemsPerPage = 5;
        let allForms = [];
        let filteredForms = [];

        // Theme Toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            document.body.classList.toggle('light-theme');
            const icon = document.querySelector('#theme-toggle i');
            if (document.body.classList.contains('dark-theme')) {
                icon.className = 'fas fa-sun';
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i> Light Mode';
            } else {
                icon.className = 'fas fa-moon';
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
            }
        });

        async function searchForms() {
            const searchCriteria = {
                month: document.getElementById('searchMonth').value,
                category: document.getElementById('searchCategory').value,
                location: document.getElementById('searchLocation').value,
                bank: document.getElementById('searchBank').value,
                status: document.getElementById('searchStatus').value,
                action: 'search'
            };

            console.log('=== WEBPAGE DEBUG: Sending search ===');
            console.log('Search criteria:', searchCriteria);

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('exportBtn').style.display = 'none';
            
            try {
                const response = await fetch(N8N_SEARCH_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(searchCriteria)
                });
                
                console.log('Response status:', response.status);
                console.log('Response OK?', response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                console.log('=== WEBPAGE DEBUG: Received response ===');
                console.log('Full response:', data);
                console.log('Success?', data.success);
                console.log('Count?', data.count);
                console.log('Results length?', data.results ? data.results.length : 0);
                console.log('Message?', data.message);
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                
                if (data.success && data.results && data.results.length > 0) {
                    console.log('✓ Will display results');
                    allForms = data.results;
                    filteredForms = allForms;
                    currentPage = 1;
                    displayResults();
                } else {
                    console.log('✗ Will display NO results');
                    displayNoResults(data.message || 'No forms found');
                }
                
            } catch (error) {
                console.error('Search Error:', error);
                document.getElementById('loading').style.display = 'none';
                displayError('Error searching forms. Please check the connection and try again.');
            }
        }

        function displayResults() {
            console.log('=== DISPLAYING RESULTS ===');
            console.log('Total forms to display:', filteredForms.length);
            
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageForms = filteredForms.slice(startIndex, endIndex);
            
            console.log('Page forms:', pageForms.length);
            
            if (pageForms.length === 0) {
                displayNoResults('No forms to display');
                return;
            }
            
            pageForms.forEach((form, index) => {
                console.log(`Creating card for form ${index}:`, form.merchantName || form.ownerName);
                
                const card = document.createElement('div');
                card.className = 'form-card';
                
                // Format MAF Date
                let mafDate = 'N/A';
                if (form.mafDate) {
                    try {
                        const date = new Date(form.mafDate);
                        mafDate = date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                    } catch (e) {
                        console.error('Date parsing error:', e);
                    }
                }
                
                card.innerHTML = `
                    <div class="card-header">
                        <div>
                            <h3 style="margin: 0; color: var(--secondary);">${form.merchantName || 'Unnamed Merchant'}</h3>
                            <div class="form-date">MAF Date: ${mafDate}</div>
                        </div>
                        <div class="form-id">S.NO: ${startIndex + index + 1}</div>
                    </div>
                    
                    <div class="details-grid">
                        <div class="detail-group">
                            <div class="detail-label">MAF DATE</div>
                            <div class="detail-value">${form.mafDate || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">MONTH</div>
                            <div class="detail-value">${form.month || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">SALES PERSON</div>
                            <div class="detail-value">${form.salesPerson || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">MERCHANT NAME</div>
                            <div class="detail-value">${form.merchantName || form.ownerName || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">CATEGORY</div>
                            <div class="detail-value">${form.category || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">LOCATION</div>
                            <div class="detail-value">${form.location || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">TEAM</div>
                            <div class="detail-value">${form.team || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">STANDEE TYPE</div>
                            <div class="detail-value">${form.standeeType || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">OWNER NAME</div>
                            <div class="detail-value">${form.ownerName || form.merchantName || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">FATHER NAME</div>
                            <div class="detail-value">${form.fatherName || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">ADDRESS</div>
                            <div class="detail-value">${form.address || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">DOB</div>
                            <div class="detail-value">${form.dob || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">CNIC NO</div>
                            <div class="detail-value">${form.cnicNo || form.cnic || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">PHONE NUMBER</div>
                            <div class="detail-value">${form.phoneNumber || form.mobileNumber || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">BANK NAME</div>
                            <div class="detail-value">${form.bankName || form.bank || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">IBAN NUMBER</div>
                            <div class="detail-value">${form.ibanNumber || form.iban || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">IBAN RECEIVED DATE</div>
                            <div class="detail-value">${form.ibanReceivedDate || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">CONVERTED TO UBL/FAYSAL</div>
                            <div class="detail-value">${form.convertedTo || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">ACCOUNT TITLE</div>
                            <div class="detail-value">${form.accountTitle || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">REMARKS</div>
                            <div class="detail-value">${form.remarks || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">STATUS-2</div>
                            <div class="detail-value">${form.status2 || form.status || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">WHATSAPP/ORIGINAL</div>
                            <div class="detail-value">${form.whatsappOriginal || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">COMMENTS</div>
                            <div class="detail-value">${form.comments || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">HAND OVER TO SALES STAFF</div>
                            <div class="detail-value">${form.handOverToSalesStaff || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">FBL REFERENCE ID</div>
                            <div class="detail-value">${form.fblReferenceId || form.referalID || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; font-size: 12px; color: var(--gray);">
                        <i class="fas fa-info-circle"></i> Last Updated: ${form.timestamp || 'N/A'}
                    </div>
                `;
                resultsList.appendChild(card);
            });
            
            updateResultsCount();
            updatePagination();
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('exportBtn').style.display = 'inline-flex';
            
            // Debug: Check if elements are visible
            console.log('resultsContainer display:', document.getElementById('resultsContainer').style.display);
            console.log('resultsList children:', document.getElementById('resultsList').children.length);
            console.log('✓ Results displayed successfully');
        }

        function updateResultsCount() {
            const total = filteredForms.length;
            const start = Math.min((currentPage - 1) * itemsPerPage + 1, total);
            const end = Math.min(currentPage * itemsPerPage, total);
            
            document.getElementById('resultsCount').textContent = 
                `Showing ${start}-${end} of ${total} form${total !== 1 ? 's' : ''}`;
        }

        function displayNoResults(message = 'No forms found') {
            console.log('Displaying no results:', message);
            
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <h3>${message}</h3>
                    <p>Try adjusting your search criteria or try different filters.</p>
                    <button class="btn btn-secondary" onclick="resetFilters()" style="margin-top: 20px;">
                        <i class="fas fa-redo"></i> Reset All Filters
                    </button>
                </div>
            `;
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('exportBtn').style.display = 'none';
            
            console.log('No results message displayed');
        }

        function displayError(message) {
            console.log('Displaying error:', message);
            
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-exclamation-triangle" style="color: var(--accent);"></i>
                    <h3>Error</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="searchForms()" style="margin-top: 20px;">
                        <i class="fas fa-sync-alt"></i> Try Again
                    </button>
                </div>
            `;
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('exportBtn').style.display = 'none';
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredForms.length / itemsPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            
            document.getElementById('pagination').style.display = totalPages > 1 ? 'flex' : 'none';
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredForms.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayResults();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayResults();
            }
        }

        function resetFilters() {
            document.getElementById('searchMonth').value = '';
            document.getElementById('searchCategory').value = '';
            document.getElementById('searchLocation').value = '';
            document.getElementById('searchBank').value = '';
            document.getElementById('searchStatus').value = '';
            
            document.getElementById('resultsContainer').style.display = 'none';
            allForms = [];
            filteredForms = [];
            currentPage = 1;
            document.getElementById('exportBtn').style.display = 'none';
            
            console.log('Filters reset');
        }

        function exportResults() {
            if (filteredForms.length === 0) {
                alert('No results to export.');
                return;
            }
            
            // Convert to CSV with new column headers
            const headers = [
                'S.NO', 'MAF DATE', 'MONTH', 'SALES PERSON', 'MERCHANT NAME',
                'CATEGORY', 'LOCATION', 'TEAM', 'STANDEE TYPE', 'OWNER NAME',
                'FATHER NAME', 'ADDRESS', 'DOB', 'CNIC NO', 'PHONE NUMBER',
                'BANK NAME', 'IBAN NUMBER', 'IBAN RECEIVED DATE', 'CONVERTED TO UBL/FAYSAL',
                'ACCOUNT TITLE', 'REMARKS', 'STATUS-2', 'WHATSAPP/ORIGINAL', 'COMMENTS',
                'HAND OVER TO SALES STAFF', 'FBL REFERENCE ID', 'TIMESTAMP'
            ];
            
            const csvData = filteredForms.map((form, index) => [
                index + 1,
                form.mafDate || '',
                form.month || '',
                form.salesPerson || '',
                form.merchantName || '',
                form.category || '',
                form.location || '',
                form.team || '',
                form.standeeType || '',
                form.ownerName || '',
                form.fatherName || '',
                form.address || '',
                form.dob || '',
                form.cnicNo || form.cnic || '',
                form.phoneNumber || form.mobileNumber || '',
                form.bankName || form.bank || '',
                form.ibanNumber || form.iban || '',
                form.ibanReceivedDate || '',
                form.convertedTo || '',
                form.accountTitle || '',
                form.remarks || '',
                form.status2 || form.status || '',
                form.whatsappOriginal || '',
                form.comments || '',
                form.handOverToSalesStaff || '',
                form.fblReferenceId || form.referalID || '',
                form.timestamp || ''
            ]);
            
            const csvContent = [
                headers.join(','),
                ...csvData.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `merchant_forms_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Exported ${filteredForms.length} forms successfully.`);
        }

        // Allow Enter key to trigger search in any input field
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchForms();
                }
            });
        });
        
        console.log('Webpage JavaScript loaded successfully');
    </script>
</body>
</html>
